{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block page_title %}Dashboard{% endblock %}

{% block extra_css %}
<style>
	.metric-card {
		border-left: 4px solid #007bff;
		transition: transform 0.2s;
	}
	.metric-card:hover {
		transform: translateY(-2px);
		box-shadow: 0 4px 8px rgba(0,0,0,0.1);
	}
	.metric-value {
		font-size: 2rem;
		font-weight: bold;
		color: #007bff;
	}
	.metric-label {
		color: #6c757d;
		font-size: 0.9rem;
		text-transform: uppercase;
		letter-spacing: 0.5px;
	}
	.status-badge {
		font-size: 0.8rem;
		padding: 0.25rem 0.5rem;
	}
	.quick-action-card {
		border: 1px solid #e9ecef;
		transition: all 0.2s;
	}
	.quick-action-card:hover {
		border-color: #007bff;
		box-shadow: 0 2px 4px rgba(0,123,255,0.1);
	}
	.activity-item {
		border-left: 3px solid #28a745;
		padding-left: 1rem;
		margin-bottom: 1rem;
	}
	.activity-time {
		font-size: 0.8rem;
		color: #6c757d;
	}
	.chart-container {
		position: relative;
		height: 300px;
	}
	.info-card {
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		color: white;
	}
	.warning-card {
		background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
		color: white;
	}
</style>
{% endblock %}

{% block content %}
<!-- Welcome Alert -->
<div class="row mb-4">
	<div class="col-12">
		<div class="alert alert-info alert-dismissible fade show" role="alert">
			<i class="fas fa-info-circle me-2"></i>
			<strong>Добро пожаловать в админ-панель!</strong> 
			Здесь вы можете управлять пользователями, создавать рассылки и просматривать аналитику.
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>
	</div>
</div>

<!-- Metrics Cards -->
<div class="row mb-4">
	<div class="col-xl-3 col-md-6 mb-4">
		<div class="card metric-card h-100">
			<div class="card-body">
				<div class="d-flex justify-content-between">
					<div>
						<div class="metric-value">{{ total_users or 0 }}</div>
						<div class="metric-label">Всего пользователей</div>
					</div>
					<div class="align-self-center">
						<i class="fas fa-users fa-2x text-primary"></i>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="col-xl-3 col-md-6 mb-4">
		<div class="card metric-card h-100">
			<div class="card-body">
				<div class="d-flex justify-content-between">
					<div>
						<div class="metric-value">{{ active_subscriptions or 0 }}</div>
						<div class="metric-label">Активные подписки</div>
					</div>
					<div class="align-self-center">
						<i class="fas fa-crown fa-2x text-warning"></i>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="col-xl-3 col-md-6 mb-4">
		<div class="card metric-card h-100">
			<div class="card-body">
				<div class="d-flex justify-content-between">
					<div>
						<div class="metric-value">{{ total_searches or 0 }}</div>
						<div class="metric-label">Поисковых запросов</div>
					</div>
					<div class="align-self-center">
						<i class="fas fa-search fa-2x text-success"></i>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="col-xl-3 col-md-6 mb-4">
		<div class="card metric-card h-100">
			<div class="card-body">
				<div class="d-flex justify-content-between">
					<div>
						<div class="metric-value">{{ revenue or 0 }}₽</div>
						<div class="metric-label">Доход за месяц</div>
					</div>
					<div class="align-self-center">
						<i class="fas fa-ruble-sign fa-2x text-info"></i>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Quick Stats -->
<div class="row mb-4">
	<div class="col-md-8">
		<div class="card">
			<div class="card-header">
				<h5 class="card-title mb-0">
					<i class="fas fa-chart-line me-2"></i>Статистика активности
				</h5>
			</div>
			<div class="card-body">
				<div class="row text-center">
					<div class="col-md-3">
						<div class="border-end">
							<div class="h4 text-primary">{{ today_users or 0 }}</div>
							<small class="text-muted">Новых пользователей сегодня</small>
						</div>
					</div>
					<div class="col-md-3">
						<div class="border-end">
							<div class="h4 text-success">{{ today_searches or 0 }}</div>
							<small class="text-muted">Поисков сегодня</small>
						</div>
					</div>
					<div class="col-md-3">
						<div class="border-end">
							<div class="h4 text-warning">{{ today_subscriptions or 0 }}</div>
							<small class="text-muted">Подписок сегодня</small>
						</div>
					</div>
					<div class="col-md-3">
						<div class="h4 text-info">{{ today_revenue or 0 }}₽</div>
						<small class="text-muted">Доход сегодня</small>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="col-md-4">
		<div class="card info-card text-white h-100">
			<div class="card-body">
				<div class="d-flex justify-content-between">
					<div>
						<h6 class="card-title">Система</h6>
						<p class="card-text">
							<small>Время работы: <span id="uptime">Загрузка...</span></small><br>
							<small>Статус: <span class="badge bg-light text-dark">Активна</span></small>
						</p>
					</div>
					<div class="align-self-center">
						<i class="fas fa-server fa-2x opacity-75"></i>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- API Endpoints Info -->
<div class="row mb-4">
	<div class="col-12">
		<div class="card">
			<div class="card-header">
				<h5 class="card-title mb-0">
					<i class="fas fa-rocket me-2"></i>Доступные API Endpoints
				</h5>
			</div>
			<div class="card-body">
				<div class="row">
					<div class="col-md-6">
						<h6>
							<i class="fas fa-users text-primary me-2"></i>Управление пользователями
						</h6>
						<ul class="list-unstyled">
							<li><code>GET /api/users/</code> - Список пользователей</li>
							<li><code>GET /api/users/{id}</code> - Детали пользователя</li>
							<li><code>PUT /api/users/{id}</code> - Обновление пользователя</li>
							<li><code>POST /api/users/{id}/subscription</code> - Управление подпиской</li>
							<li><code>GET /api/users/analytics/</code> - Аналитика пользователей</li>
						</ul>
					</div>
					<div class="col-md-6">
						<h6>
							<i class="fas fa-shield-alt text-success me-2"></i>Аутентификация
						</h6>
						<ul class="list-unstyled">
							<li><code>POST /api/auth/login</code> - Вход в систему</li>
							<li><code>POST /api/auth/refresh</code> - Обновление токена</li>
							<li><code>GET /api/auth/me</code> - Текущий пользователь</li>
							<li><code>POST /api/auth/change-password</code> - Смена пароля</li>
						</ul>
					</div>
				</div>

				<div class="mt-3">
					<a href="/api/docs" class="btn btn-primary" target="_blank">
						<i class="fas fa-book me-2"></i>Полная документация API
					</a>
					<a href="/api/redoc" class="btn btn-outline-primary" target="_blank">
						<i class="fas fa-file-alt me-2"></i>ReDoc документация
					</a>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Security Warning -->
<div class="row mb-4">
	<div class="col-12">
		<div class="card border-warning">
			<div class="card-header bg-warning text-dark">
				<h6 class="card-title mb-0">
					<i class="fas fa-exclamation-triangle me-2"></i>Важная информация по безопасности
				</h6>
			</div>
			<div class="card-body">
				<ul class="mb-0">
					<li>
						<strong>Смените пароль по умолчанию</strong> через API endpoint
						<code>POST /api/auth/change-password</code>
					</li>
					<li>
						<strong>В production</strong> обязательно настройте HTTPS и
						обновите секретные ключи в .env файле
					</li>
					<li>
						<strong>Регулярно проверяйте логи</strong> административных
						действий в таблице audit_logs
					</li>
				</ul>
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% block extra_js %}
<script>
	// Автообновление времени на странице
	function updateTime() {
		const now = new Date()
		const timeString = now.toLocaleString('ru-RU')
		const uptimeElements = document.querySelectorAll('#uptime')
		uptimeElements.forEach(el => el.textContent = timeString)
	}

	// Обновляем каждую минуту
	setInterval(updateTime, 60000)
	updateTime()
</script>
{% endblock %}
